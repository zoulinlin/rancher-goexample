workspace:
  base: /go
  path: src/github.com/zoulinlin/rancher-goexample

pipeline:
  test:
    image: golang:latest
    commands:
      - go get ./...
      - go test
  publish:
    image: plugins/docker
    repo: zoulinlin/demo
    tag: "${DRONE_COMMIT_SHA:0:8}"
    secrets: [ docker_username, docker_password ]
  deploy:
    image: quay.io/honestbee/drone-kubernetes
    deployment: demo
    repo: zoulinlin/demo
    container: demo
    tag: "${DRONE_COMMIT_SHA:0:8}"
    namespace: drone
    secrets: [ kubernetes_token, kubernetes_cert, kubernetes_server ]
